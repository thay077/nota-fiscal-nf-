<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nota Fiscal Automotiva</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e6f0fa;
      color: #03396c;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1, h2 {
      margin: 0 0 15px 0;
    }
    .container {
      background: white;
      border-radius: 8px;
      padding: 20px 30px;
      margin: 20px;
      width: 90%;
      max-width: 900px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input[type="text"], input[type="number"], select {
      width: 100%;
      padding: 6px 10px;
      margin-top: 5px;
      border: 1px solid #b0c4de;
      border-radius: 4px;
      font-size: 14px;
      color: #03396c;
    }
    button {
      margin-top: 15px;
      background-color: #4a90e2;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 15px;
    }
    button:hover {
      background-color: #357ABD;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 14px;
    }
    th, td {
      padding: 8px 10px;
      border: 1px solid #b0c4de;
      text-align: center;
      color: #03396c;
    }
    thead {
      background-color: #cce0ff;
    }
    tfoot th {
      background-color: #cce0ff;
      text-align: right;
    }
    .btn-excluir {
      background-color: #cc4444;
      color: white;
      border: none;
      padding: 5px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn-excluir:hover {
      background-color: #aa2222;
    }
    .flex-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: space-between;
    }
    .flex-50 {
      flex: 1 1 48%;
    }
    .login-container {
      max-width: 400px;
      margin-top: 100px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<div id="login" class="container login-container">
  <h2>Login</h2>
  <label for="inputUsuario">Usuário</label>
  <input type="text" id="inputUsuario" placeholder="Digite seu usuário" />
  <label for="inputSenha">Senha</label>
  <input type="password" id="inputSenha" placeholder="Digite sua senha" />
  <button onclick="fazerLogin()">Entrar</button>

  <h3 style="margin-top: 25px;">Usuários cadastrados</h3>
  <table>
    <thead>
      <tr><th>Usuário</th><th>Senha</th></tr>
    </thead>
    <tbody>
      <tr><td>admin</td><td>1234</td></tr>
      <tr><td>usuario1</td><td>senha1</td></tr>
      <tr><td>usuario2</td><td>senha2</td></tr>
    </tbody>
  </table>
</div>

<div id="app" class="container hidden">

  <h1>Nota Fiscal Automotiva</h1>

  <label for="selectUsuario">Usuário emissor:</label>
  <select id="selectUsuario"></select>

  <hr />

  <div class="flex-row">
    <div class="flex-50">
      <h3>Dados da Loja Emitente</h3>
      <label for="nomeLoja">Nome da Loja</label>
      <input type="text" id="nomeLoja" placeholder="Nome da loja emitente" />

      <label for="enderecoLoja">Endereço</label>
      <input type="text" id="enderecoLoja" placeholder="Endereço da loja" />

      <label for="cnpjLoja">CNPJ</label>
      <input type="text" id="cnpjLoja" placeholder="00.000.000/0000-00" />
    </div>

    <div class="flex-50">
      <h3>Dados do Cliente</h3>
      <label for="nomeCliente">Nome do Cliente</label>
      <input type="text" id="nomeCliente" placeholder="Nome do cliente" />

      <label for="cpfCnpjCliente">CPF ou CNPJ</label>
      <input type="text" id="cpfCnpjCliente" placeholder="CPF ou CNPJ do cliente" />

      <label for="enderecoCliente">Endereço</label>
      <input type="text" id="enderecoCliente" placeholder="Endereço do cliente" />
    </div>
  </div>

  <hr />

  <h3>Adicionar Produto</h3>
  <label for="selectProdutos">Selecione o produto</label>
  <select id="selectProdutos"></select>

  <label for="quantidadeProduto">Quantidade</label>
  <input type="number" id="quantidadeProduto" min="1" value="1" />

  <label for="valorProduto">Valor Unitário (R$)</label>
  <input type="text" id="valorProduto" placeholder="Exemplo: 150.00" />

  <button onclick="adicionarProduto()">Adicionar Produto</button>

  <table id="tabelaProdutos">
    <thead>
      <tr>
        <th>Código</th>
        <th>Produto</th>
        <th>Quantidade</th>
        <th>Valor Unitário (R$)</th>
        <th>Subtotal (R$)</th>
        <th>Ação</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr>
        <th colspan="5" style="text-align:right">Total:</th>
        <th id="totalNota">R$ 0,00</th>
      </tr>
    </tfoot>
  </table>

  <hr />

  <button onclick="gerarNota()">Gerar Nota Fiscal</button>

  <div id="notaFiscal" style="margin-top: 25px;"></div>
</div>

<script>
  // Usuários fixos para a tabela e select
  const usuarios = [
    { usuario: "admin", senha: "1234" },
    { usuario: "usuario1", senha: "senha1" },
    { usuario: "usuario2", senha: "senha2" },
  ];

  // Produtos fixos para seleção - peças para carro e moto
  const produtosDisponiveis = [
    "Óleo Motor 5W30",
    "Filtro de Óleo",
    "Filtro de Ar",
    "Velas de Ignição",
    "Pastilhas de Freio",
    "Disco de Freio",
    "Bateria 12V",
    "Correia Dentada",
    "Amortecedor",
    "Lanterna Traseira",
    "Pneu 205/55 R16",
    "Cabo de Embreagem",
    "Escapamento",
    "Farol Dianteiro",
    "Bomba de Combustível",
    "Filtro de Combustível",
    "Câmbio",
    "Embreagem",
    "Pneu Moto 120/70",
    "Capacete",
    "Protetor de Motor",
    "Farol de Moto",
    "Freio a Disco de Moto",
    "Corrente para Moto",
  ];

  let produtosNota = [];

  // Popula o select de usuários
  function popularUsuarios() {
    const select = document.getElementById("selectUsuario");
    select.innerHTML = "";
    usuarios.forEach(u => {
      const option = document.createElement("option");
      option.value = u.usuario;
      option.textContent = u.usuario;
      select.appendChild(option);
    });
  }

  // Popula o select de produtos
  function popularProdutos() {
    const select = document.getElementById("selectProdutos");
    select.innerHTML = "";
    produtosDisponiveis.forEach(prod => {
      const option = document.createElement("option");
      option.value = prod;
      option.textContent = prod;
      select.appendChild(option);
    });
  }

  // Função para login (qualquer usuário e senha aceitos)
  function fazerLogin() {
    const usuarioInput = document.getElementById("inputUsuario").value.trim();
    const senhaInput = document.getElementById("inputSenha").value.trim();

    if (usuarioInput === "" || senhaInput === "") {
      alert("Por favor, preencha usuário e senha.");
      return;
    }
    // Não faz validação de senha, aceita qualquer um.

    // Esconde tela login e mostra app
    document.getElementById("login").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");

    popularUsuarios();
    popularProdutos();
  }

  // Atualiza a tabela de produtos na nota
  function atualizarTabelaProdutos() {
    const tbody = document.querySelector("#tabelaProdutos tbody");
    tbody.innerHTML = "";

    let total = 0;
    produtosNota.forEach((item, index) => {
      const tr = document.createElement("tr");

      const codigo = String(index + 1).padStart(2, "0");
      const tdCodigo = document.createElement("td");
      tdCodigo.textContent = codigo;
      tr.appendChild(tdCodigo);

      const tdProduto = document.createElement("td");
      tdProduto.textContent = item.produto;
      tr.appendChild(tdProduto);

      const tdQuantidade = document.createElement("td");
      tdQuantidade.textContent = item.quantidade;
      tr.appendChild(tdQuantidade);

      const tdValor = document.createElement("td");
      tdValor.textContent = item.valor.toFixed(2).replace(".", ",");
      tr.appendChild(tdValor);

      const subtotal = item.quantidade * item.valor;
      total += subtotal;
      const tdSubtotal = document.createElement("td");
      tdSubtotal.textContent = subtotal.toFixed(2).replace(".", ",");
      tr.appendChild(tdSubtotal);

      const tdAcao = document.createElement("td");
      const btnExcluir = document.createElement("button");
      btnExcluir.textContent = "Excluir";
      btnExcluir.className = "btn-excluir";
      btnExcluir.onclick = () => {
        produtosNota.splice(index, 1);
        atualizarTabelaProdutos();
      };
      tdAcao.appendChild(btnExcluir);
      tr.appendChild(tdAcao);

      tbody.appendChild(tr);
    });

    document.getElementById("totalNota").textContent =
      "R$ " + total.toFixed(2).replace(".", ",");
  }

  // Adiciona produto selecionado à tabela da nota
  function adicionarProduto() {
    const produto = document.getElementById("selectProdutos").value;
    const quantidade = parseInt(document.getElementById("quantidadeProduto").value);
    const valorText = document.getElementById("valorProduto").value.replace(",", ".");
    const valor = parseFloat(valorText);

    if (!produto) {
      alert("Selecione um produto.");
      return;
    }
    if (isNaN(quantidade) || quantidade <= 0) {
      alert("Informe uma quantidade válida.");
      return;
    }
    if (isNaN(valor) || valor <= 0) {
      alert("Informe um valor válido.");
      return;
    }

    produtosNota.push({ produto, quantidade, valor });
    atualizarTabelaProdutos();

    // Limpa quantidade e valor para facilitar próximo cadastro
    document.getElementById("quantidadeProduto").value = 1;
    document.getElementById("valorProduto").value = "";
  }

  // Gera a nota fiscal em HTML com os dados preenchidos
  function gerarNota() {
    if (produtosNota.length === 0) {
      alert("Adicione ao menos um produto antes de gerar a nota.");
      return;
    }

    const nomeLoja = document.getElementById("nomeLoja").value.trim();
    const enderecoLoja = document.getElementById("enderecoLoja").value.trim();
    const cnpjLoja = document.getElementById("cnpjLoja").value.trim();

    const nomeCliente = document.getElementById("nomeCliente").value.trim();
    const cpfCnpjCliente = document.getElementById("cpfCnpjCliente").value.trim();
    const enderecoCliente = document.getElementById("enderecoCliente").value.trim();

    if (!nomeLoja || !nomeCliente) {
      alert("Preencha ao menos o nome da loja e do cliente.");
      return;
    }

    const usuarioEmissor = document.getElementById("selectUsuario").value;

    const agora = new Date();
    const dataStr = agora.toLocaleDateString('pt-BR');
    const horaStr = agora.toLocaleTimeString('pt-BR');

    // Monta HTML da nota
    let html = `
      <div style="border: 2px solid #4a90e2; border-radius: 8px; padding: 20px; background: #f0f8ff;">
        <h2 style="color:#03396c; margin-top:0;">Nota Fiscal</h2>
        <p><strong>Emitida em:</strong> ${dataStr} às ${horaStr}</p>
        <p><strong>Emitente:</strong> ${usuarioEmissor}</p>

        <h3>Dados da Loja Emitente</h3>
        <p><strong>Nome:</strong> ${nomeLoja}</p>
        <p><strong>Endereço:</strong> ${enderecoLoja}</p>
        <p><strong>CNPJ:</strong> ${cnpjLoja}</p>

        <h3>Dados do Cliente</h3>
        <p><strong>Nome:</strong> ${nomeCliente}</p>
        <p><strong>CPF/CNPJ:</strong> ${cpfCnpjCliente}</p>
        <p><strong>Endereço:</strong> ${enderecoCliente}</p>

        <h3>Produtos</h3>
        <table style="width:100%; border-collapse: collapse;" border="1">
          <thead style="background-color: #cce0ff;">
            <tr>
              <th>Código</th>
              <th>Produto</th>
              <th>Quantidade</th>
              <th>Valor Unitário (R$)</th>
              <th>Subtotal (R$)</th>
            </tr>
          </thead>
          <tbody>
    `;

    let totalNota = 0;
    produtosNota.forEach((item, i) => {
      const codigo = String(i + 1).padStart(2, "0");
      const subtotal = item.quantidade * item.valor;
      totalNota += subtotal;

      html += `
        <tr>
          <td style="text-align:center;">${codigo}</td>
          <td>${item.produto}</td>
          <td style="text-align:center;">${item.quantidade}</td>
          <td style="text-align:right;">R$ ${item.valor.toFixed(2).replace('.', ',')}</td>
          <td style="text-align:right;">R$ ${subtotal.toFixed(2).replace('.', ',')}</td>
        </tr>
      `;
    });

    html += `
          </tbody>
          <tfoot>
            <tr style="background-color: #cce0ff;">
              <th colspan="4" style="text-align:right;">Total:</th>
              <th style="text-align:right;">R$ ${totalNota.toFixed(2).replace('.', ',')}</th>
            </tr>
          </tfoot>
        </table>
      </div>
    `;

    document.getElementById("notaFiscal").innerHTML = html;
  }
</script>

</body>
</html>