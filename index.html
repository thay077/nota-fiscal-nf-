<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PALMAS AUTO PEÇAS - NOTA FISCAL</title>
  <style>
    body { font-family: Arial, sans-serif; background: #e6f0fa; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #005a9c; }
    .container { max-width: 1200px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    .login, .painel, .cadastro, .nota-fiscal { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #005a9c; color: white; }
    button { background: #005a9c; color: white; border: none; padding: 8px 12px; cursor: pointer; margin: 5px 0; }
    input, select { padding: 6px; width: 100%; margin: 4px 0; }
    .flex { display: flex; gap: 20px; }
    .flex > div { flex: 1; }
  </style>
</head>
<body>
  <div class="container">
    <h1>PALMAS AUTO PEÇAS - NOTA FISCAL</h1>

    <div class="login">
      <h2>Login</h2>
      <select id="usuarioSelect"></select>
      <input type="password" id="senha" placeholder="Senha (qualquer)" />
      <button onclick="entrar()">Entrar</button>
    </div>

    <div class="painel">
      <h2>Bem-vindo</h2>
      <button onclick="mostrarCadastroCliente()">Cadastrar Cliente</button>
      <button onclick="mostrarCadastroProduto()">Cadastrar Produto</button>
      <button onclick="mostrarNotaFiscal()">Emitir Nota Fiscal</button>
      <button onclick="mostrarRelatorio()">Relatórios</button>
    </div>

    <div class="cadastro" id="cadastroCliente">
      <h2>Cadastro de Cliente</h2>
      <input type="text" id="clienteNome" placeholder="Nome do Cliente" />
      <input type="text" id="clienteCPF" placeholder="CPF ou CNPJ" />
      <input type="text" id="clienteEndereco" placeholder="Endereço" />
      <button onclick="salvarCliente()">Salvar Cliente</button>
    </div>

    <div class="cadastro" id="cadastroProduto">
      <h2>Cadastro de Produto</h2>
      <input type="text" id="produtoNome" placeholder="Nome do Produto" />
      <input type="number" id="produtoValor" placeholder="Valor" />
      <button onclick="salvarProduto()">Salvar Produto</button>
      <table id="tabelaProdutos"></table>
    </div>

    <div class="nota-fiscal">
      <h2>Emitir Nota Fiscal</h2>
      <div class="flex">
        <div>
          <label>Data/Hora:</label>
          <input type="text" id="dataHora" disabled />
          <label>Emitente:</label>
          <input type="text" value="PALMAS AUTO PEÇAS" disabled />
          <label>Cliente:</label>
          <select id="clienteSelect"></select>
          <label>Forma de Pagamento:</label>
          <select id="pagamento">
            <option>Dinheiro</option>
            <option>Cartão</option>
            <option>Pix</option>
            <option>Boleto</option>
          </select>
        </div>
        <div>
          <label>Produto:</label>
          <select id="produtoSelect"></select>
          <label>Quantidade:</label>
          <input type="number" id="quantidade" />
          <label>Desconto:</label>
          <input type="number" id="desconto" placeholder="R$" />
          <label>Frete:</label>
          <input type="number" id="frete" placeholder="R$" />
          <button onclick="adicionarItem()">Adicionar Produto</button>
        </div>
      </div>
      <table id="tabelaNota"></table>
      <button onclick="gerarPDF()">Exportar PDF</button>
    </div>

    <div class="relatorios">
      <h2>Relatório de Vendas</h2>
      <p>Em breve...</p>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    const usuarios = ['Admin', 'Caixa 1', 'Caixa 2'];
    const clientes = [];
    const produtos = [
      { nome: 'Filtro de óleo', valor: 30.0, codigo: '01' },
      { nome: 'Pastilha de freio', valor: 120.0, codigo: '02' },
      { nome: 'Bateria 12V', valor: 320.0, codigo: '03' }
    ];
    const notaItens = [];

    // Inicialização
    window.onload = () => {
      document.querySelector('.login').style.display = 'block';
      const usuarioSelect = document.getElementById('usuarioSelect');
      usuarios.forEach(u => {
        const opt = document.createElement('option');
        opt.value = opt.textContent = u;
        usuarioSelect.appendChild(opt);
      });
      atualizarTabelaProdutos();
    };

    function entrar() {
      document.querySelector('.login').style.display = 'none';
      document.querySelector('.painel').style.display = 'block';
    }

    function mostrarCadastroCliente() {
      ocultarTelas();
      document.getElementById('cadastroCliente').style.display = 'block';
    }

    function mostrarCadastroProduto() {
      ocultarTelas();
      document.getElementById('cadastroProduto').style.display = 'block';
      atualizarTabelaProdutos();
    }

    function mostrarNotaFiscal() {
      ocultarTelas();
      document.querySelector('.nota-fiscal').style.display = 'block';
      document.getElementById('dataHora').value = new Date().toLocaleString();
      atualizarSelects();
      atualizarTabelaNota();
    }

    function mostrarRelatorio() {
      ocultarTelas();
      document.querySelector('.relatorios').style.display = 'block';
    }

    function ocultarTelas() {
      document.querySelectorAll('.cadastro, .nota-fiscal, .relatorios').forEach(e => e.style.display = 'none');
    }

    function salvarCliente() {
      const nome = document.getElementById('clienteNome').value;
      const cpf = document.getElementById('clienteCPF').value;
      const endereco = document.getElementById('clienteEndereco').value;
      if (nome && cpf && endereco) {
        clientes.push({ nome, cpf, endereco });
        alert('Cliente salvo!');
      }
    }

    function salvarProduto() {
      const nome = document.getElementById('produtoNome').value;
      const valor = parseFloat(document.getElementById('produtoValor').value);
      const codigo = (produtos.length + 1).toString().padStart(2, '0');
      produtos.push({ nome, valor, codigo });
      atualizarTabelaProdutos();
    }

    function atualizarTabelaProdutos() {
      const tabela = document.getElementById('tabelaProdutos');
      tabela.innerHTML = '<tr><th>Código</th><th>Nome</th><th>Valor</th><th>Ação</th></tr>';
      produtos.forEach((p, i) => {
        tabela.innerHTML += `<tr><td>${p.codigo}</td><td>${p.nome}</td><td>R$ ${p.valor.toFixed(2)}</td><td><button onclick="excluirProduto(${i})">Excluir</button></td></tr>`;
      });
    }

    function excluirProduto(index) {
      produtos.splice(index, 1);
      atualizarTabelaProdutos();
    }

    function atualizarSelects() {
      const clienteSel = document.getElementById('clienteSelect');
      clienteSel.innerHTML = '';
      clientes.forEach(c => {
        const opt = document.createElement('option');
        opt.value = opt.textContent = c.nome;
        clienteSel.appendChild(opt);
      });

      const prodSel = document.getElementById('produtoSelect');
      prodSel.innerHTML = '';
      produtos.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.nome;
        opt.textContent = `${p.codigo} - ${p.nome}`;
        prodSel.appendChild(opt);
      });
    }

    function adicionarItem() {
      const nome = document.getElementById('produtoSelect').value;
      const quantidade = parseInt(document.getElementById('quantidade').value);
      const desconto = parseFloat(document.getElementById('desconto').value || 0);
      const frete = parseFloat(document.getElementById('frete').value || 0);
      const produto = produtos.find(p => p.nome === nome);
      const subtotal = produto.valor * quantidade;
      const imposto = subtotal * 0.12; // 12%
      const total = subtotal + imposto + frete - desconto;
      notaItens.push({ ...produto, quantidade, imposto, desconto, frete, total });
      atualizarTabelaNota();
    }

    function atualizarTabelaNota() {
      const tabela = document.getElementById('tabelaNota');
      tabela.innerHTML = '<tr><th>Produto</th><th>Qtd</th><th>Imposto</th><th>Desconto</th><th>Frete</th><th>Total</th></tr>';
      notaItens.forEach(item => {
        tabela.innerHTML += `<tr><td>${item.nome}</td><td>${item.quantidade}</td><td>R$ ${item.imposto.toFixed(2)}</td><td>R$ ${item.desconto.toFixed(2)}</td><td>R$ ${item.frete.toFixed(2)}</td><td>R$ ${item.total.toFixed(2)}</td></tr>`;
      });
    }

    function gerarPDF() {
      html2pdf().from(document.querySelector('.nota-fiscal')).save('nota_fiscal.pdf');
    }
  </script>
</body>
</html>
